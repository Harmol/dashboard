(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-513f8512"],{1146:function(e,t,a){"use strict";a("b994")},"60e2":function(e,t,a){"use strict";a("ebb4")},"63e8":function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var r=a("b775");function n(e){return Object(r["a"])({url:"/v1/operationSets",method:"get",params:e})}},b994:function(e,t,a){},be39:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("div",{staticStyle:{"margin-bottom":"8px"}},[a("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.createNewDiagnosis}},[e._v("创建触发式诊断任务")])],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],staticStyle:{width:"100%"},attrs:{data:e.tableView,"header-cell-style":{background:"#F5F7FA",color:"#000",fontWeight:"900"}}},[a("el-table-column",{attrs:{prop:"name",label:"诊断触发器名称","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"type",label:"诊断类型","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"operationSet",label:"诊断流水线","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.editData(t.row)}}},[e._v("查看详情\n          ")])]}}])})],1),e._v(" "),a("div",{staticStyle:{"text-align":"right",margin:"20px 0"}},[a("el-pagination",{attrs:{"current-page":e.pagination.currentPage,"page-sizes":[10,20,30,50],"page-size":e.pagination.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.pagination.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),a("creattask",{ref:"add",on:{success:e.triggersSetsFn}}),e._v(" "),a("taskInfo",{ref:"info"})],1)},n=[],o=(a("7f7f"),a("b775"));function s(e){return Object(o["a"])({url:"/v1/triggers",method:"get",params:e})}function i(e){return Object(o["a"])({url:"/v1/triggers/".concat(e.name),method:"post",data:e})}var l=a("ed08"),c=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{attrs:{title:"触发式诊断任务",visible:e.dialogVisible,width:"50%",top:"5vh"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],ref:"form",attrs:{model:e.form,"label-width":"140px",rules:e.rules,"label-position":"left"}},[a("el-form-item",{key:"name",attrs:{label:"诊断任务名称",prop:"name"}},[a("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),a("el-form-item",{key:"operationSet",attrs:{label:"触发诊断模板",prop:"operationSet"}},[a("el-select",{attrs:{filterable:"",placeholder:"请选择"},model:{value:e.form.operationSet,callback:function(t){e.$set(e.form,"operationSet",t)},expression:"form.operationSet"}},e._l(e.operationsSet,(function(e){return a("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})})),1)],1),e._v(" "),a("el-form-item",{key:"type",attrs:{label:"触发诊断类型",prop:"type"}},[a("el-radio-group",{model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},[a("el-radio",{attrs:{label:"Prometheus"}},[e._v("Prometheus报警")]),e._v(" "),a("el-radio",{attrs:{label:"Kubernetes"}},[e._v("Kubernetes事件")])],1)],1),e._v(" "),"Prometheus"===e.form.type?[a("el-form-item",{key:"resource",attrs:{label:"触发诊断目标",prop:"resource"}},[a("el-radio-group",{model:{value:e.form.resource,callback:function(t){e.$set(e.form,"resource",t)},expression:"form.resource"}},[a("el-radio",{attrs:{label:"node"}}),e._v(" "),a("el-radio",{attrs:{label:"pod"}})],1)],1),e._v(" "),"node"===e.form.resource?[a("el-form-item",{key:"nodeNameReferenceLabel",attrs:{label:"node标签",prop:"nodeNameReferenceLabel"}},[a("el-input",{model:{value:e.form.nodeNameReferenceLabel,callback:function(t){e.$set(e.form,"nodeNameReferenceLabel",t)},expression:"form.nodeNameReferenceLabel"}})],1)]:[a("el-form-item",{key:"podNamespaceReferenceLabel",attrs:{label:"Namespace标签",prop:"podNamespaceReferenceLabel"}},[a("el-input",{model:{value:e.form.podNamespaceReferenceLabel,callback:function(t){e.$set(e.form,"podNamespaceReferenceLabel",t)},expression:"form.podNamespaceReferenceLabel"}})],1),e._v(" "),a("el-form-item",{key:"podNameReferenceLabel",attrs:{label:"Pod标签",prop:"podNameReferenceLabel"}},[a("el-input",{model:{value:e.form.podNameReferenceLabel,callback:function(t){e.$set(e.form,"podNameReferenceLabel",t)},expression:"form.podNameReferenceLabel"}})],1)],e._v(" "),a("el-form-item",{key:"alertName",attrs:{label:"报警名称",prop:"alertName"}},[a("el-input",{model:{value:e.form.alertName,callback:function(t){e.$set(e.form,"alertName",t)},expression:"form.alertName"}})],1),e._v(" "),a("el-form-item",{key:"parameterInjectionLabels",attrs:{label:"Parameter标签",prop:"parameterInjectionLabels"}},[a("el-input",{model:{value:e.form.parameterInjectionLabels,callback:function(t){e.$set(e.form,"parameterInjectionLabels",t)},expression:"form.parameterInjectionLabels"}})],1),e._v(" "),a("el-button",{attrs:{type:"text",icon:e.showMoreFormItem?"el-icon-arrow-down":"el-icon-arrow-up"},on:{click:function(t){e.showMoreFormItem=!e.showMoreFormItem}}},[e._v("高级配置\n        ")]),e._v(" "),e.showMoreFormItem?["pod"===e.form.resource?[a("el-form-item",{key:"containerReferenceLabel",attrs:{label:"容器标签",prop:"containerReferenceLabel"}},[a("el-input",{model:{value:e.form.containerReferenceLabel,callback:function(t){e.$set(e.form,"containerReferenceLabel",t)},expression:"form.containerReferenceLabel"}})],1)]:e._e(),e._v(" "),a("el-form-item",{key:"labels",attrs:{label:"报警标签",prop:"labels"}},[a("el-input",{model:{value:e.form.labels,callback:function(t){e.$set(e.form,"labels",t)},expression:"form.labels"}})],1),e._v(" "),a("el-form-item",{key:"annotations",attrs:{label:"报警注解",prop:"annotations"}},[a("el-input",{model:{value:e.form.annotations,callback:function(t){e.$set(e.form,"annotations",t)},expression:"form.annotations"}})],1),e._v(" "),a("el-form-item",{key:"startsAt",attrs:{label:"开始时间",prop:"startsAt"}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间"},model:{value:e.form.startsAt,callback:function(t){e.$set(e.form,"startsAt",t)},expression:"form.startsAt"}})],1),e._v(" "),a("el-form-item",{key:"endsAt",attrs:{label:"结束时间",prop:"endsAt"}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间"},model:{value:e.form.endsAt,callback:function(t){e.$set(e.form,"endsAt",t)},expression:"form.endsAt"}})],1),e._v(" "),a("el-form-item",{key:"generatorURL",attrs:{label:"GeneratorURL",prop:"generatorURL"}},[a("el-input",{model:{value:e.form.generatorURL,callback:function(t){e.$set(e.form,"generatorURL",t)},expression:"form.generatorURL"}})],1)]:e._e()]:[a("el-form-item",{key:"namespace",attrs:{label:"Namespace",prop:"namespace"}},[a("el-select",{attrs:{filterable:"",placeholder:"请选择"},model:{value:e.form.namespace,callback:function(t){e.$set(e.form,"namespace",t)},expression:"form.namespace"}},e._l(e.namespaces,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),e._v(" "),a("el-form-item",{key:"eventname",attrs:{label:"事件名称",prop:"eventname"}},[a("el-input",{model:{value:e.form.eventname,callback:function(t){e.$set(e.form,"eventname",t)},expression:"form.eventname"}})],1),e._v(" "),a("el-form-item",{key:"reason",attrs:{label:"Reason",prop:"reason"}},[a("el-input",{model:{value:e.form.reason,callback:function(t){e.$set(e.form,"reason",t)},expression:"form.reason"}})],1),e._v(" "),a("el-form-item",{key:"message",attrs:{label:"Message",prop:"message"}},[a("el-input",{model:{value:e.form.message,callback:function(t){e.$set(e.form,"message",t)},expression:"form.message"}})],1),e._v(" "),a("div",{staticClass:"el-form-item el-form-item--medium is-required",staticStyle:{"margin-bottom":"0"}},[a("label",{staticClass:"el-form-item__label",staticStyle:{width:"140px"}},[e._v("source")])]),e._v(" "),a("el-form-item",{key:"component",staticClass:"subform-item",attrs:{label:"component",prop:"component"}},[a("el-input",{model:{value:e.form.component,callback:function(t){e.$set(e.form,"component",t)},expression:"form.component"}})],1),e._v(" "),a("el-form-item",{key:"host",staticClass:"subform-item",attrs:{label:"host",prop:"host"}},[a("el-input",{model:{value:e.form.host,callback:function(t){e.$set(e.form,"host",t)},expression:"form.host"}})],1)],e._v(" "),a("el-form-item",[a("el-button",{on:{click:e.closeDialog}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("立即创建")])],1)],2)],1)],1)},m=[],u=(a("96cf"),a("1da1")),p=a("d510"),f=a("63e8"),d={components:{},props:{},data:function(){return{isLoading:!1,dialogVisible:!1,showMoreFormItem:!1,form:{type:"Prometheus",resource:"node",name:"",operationSet:"",nodeNameReferenceLabel:"",podNamespaceReferenceLabel:"",podNameReferenceLabel:"",containerReferenceLabel:"",parameterInjectionLabels:"",alertName:"",labels:"",annotations:"",startsAt:"",endsAt:"",generatorURL:"",namespace:"",eventname:"",reason:"",message:"",component:"",host:""},rules:{name:[{required:!0,trigger:"blur",message:"请输入"},{validator:this.validatePass,trigger:"blur"}],resource:[{required:!0,trigger:"blur",message:"请输入"}],type:[{required:!0,trigger:"blur",message:"请输入"}],operationSet:[{required:!0,trigger:"change",message:"请选择"}],nodeNameReferenceLabel:[{required:!0,trigger:"blur",message:"请输入"}],alertName:[{required:!0,trigger:"blur",message:"请输入"}],podNamespaceReferenceLabel:[{required:!0,trigger:"blur",message:"请输入"}],podNameReferenceLabel:[{required:!0,trigger:"blur",message:"请输入"}],namespace:[{required:!0,trigger:"change",message:"请输入"}],eventname:[{required:!0,trigger:"blur",message:"请输入"}],reason:[{required:!0,trigger:"blur",message:"请输入"}],message:[{required:!0,trigger:"blur",message:"请输入"}],component:[{required:!0,trigger:"blur",message:"请输入"}],host:[{required:!0,trigger:"blur",message:"请输入"}]},operationsSet:[],namespaces:[]}},mounted:function(){this.operations(),this.getnamespaces()},methods:{checkName:function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(t,a){var r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r={name:t,kind:a},e.next=3,Object(p["a"])(r);case 3:if(n=e.sent,n.success){e.next=6;break}return e.abrupt("return",n.message);case 6:case"end":return e.stop()}}),e)})));function t(t,a){return e.apply(this,arguments)}return t}(),validatePass:function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(t,a,r){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(""!==a){e.next=4;break}r(new Error("请输入")),e.next=10;break;case 4:if(""===a){e.next=9;break}return e.next=7,this.checkName(a,"Operation");case 7:n=e.sent,n&&r(new Error(n));case 9:r();case 10:case"end":return e.stop()}}),e,this)})));function t(t,a,r){return e.apply(this,arguments)}return t}(),operations:function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={},e.next=3,Object(f["a"])(t);case 3:a=e.sent,a.success&&(this.operationsSet=a.data);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),getnamespaces:function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={},e.next=3,Object(p["d"])(t);case 3:a=e.sent,a.success&&(this.namespaces=a.data);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),openDialog:function(){var e=this;this.dialogVisible=!0,this.isLoading=!1,this.resetForm(),this.$nextTick((function(){e.$refs.form.resetFields()}))},resetForm:function(){this.form={type:"Prometheus",resource:"node",name:"",operationSet:"",nodeNameReferenceLabel:"",podNamespaceReferenceLabel:"",podNameReferenceLabel:"",containerReferenceLabel:"",parameterInjectionLabels:"",alertName:"",labels:"",annotations:"",startsAt:"",endsAt:"",generatorURL:"",namespace:"",eventname:"",reason:"",message:"",component:"",host:""}},closeDialog:function(){this.dialogVisible=!1,this.resetForm()},onSubmit:function(){var e=this;this.$refs["form"].validate(function(){var t=Object(u["a"])(regeneratorRuntime.mark((function t(a){var r,n,o,s,l,c,m,u,p,f,d,b,g,h,v,k,L,y,R,w,x,_,N,S;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!a){t.next=18;break}return e.isLoading=!0,r=e.form,n=r.type,o=r.resource,s=r.name,l=r.operationSet,c=r.nodeNameReferenceLabel,m=r.podNamespaceReferenceLabel,u=r.podNameReferenceLabel,p=r.containerReferenceLabel,f=r.parameterInjectionLabels,d=r.alertName,b=r.labels,g=r.annotations,h=r.startsAt,v=r.endsAt,k=r.generatorURL,L=r.namespace,y=r.eventname,R=r.reason,w=r.message,x=r.component,_=r.host,N={name:s,operationSet:l,prometheusAlertTemplate:null,kubernetesEventTemplate:null},"Prometheus"===n?(N.prometheusAlertTemplate={parameterInjectionLabels:f||null,regexp:{alertName:d||null,labels:b||null,annotations:g||null,startsAt:h||null,endsAt:v||null,generatorURL:k||null}},"node"===o?Object.assign(N.prometheusAlertTemplate,{nodeNameReferenceLabel:c||null}):Object.assign(N.prometheusAlertTemplate,{podNamespaceReferenceLabel:m||null,podNameReferenceLabel:u||null,containerReferenceLabel:p||null})):N.kubernetesEventTemplate={regexp:{namespace:L||null,name:y||null,reason:R||null,message:w||null,source:{component:x||null,host:_||null}}},t.prev=5,t.next=8,i(N);case 8:S=t.sent,S.success&&(e.closeDialog(),e.$emit("success")),e.isLoading=!1,t.next=16;break;case 13:t.prev=13,t.t0=t["catch"](5),e.isLoading=!1;case 16:t.next=20;break;case 18:return console.log("error submit!!"),t.abrupt("return",!1);case 20:case"end":return t.stop()}}),t,null,[[5,13]])})));return function(e){return t.apply(this,arguments)}}())}}},b=d,g=(a("1146"),a("2877")),h=Object(g["a"])(b,c,m,!1,null,"61e6faca",null),v=h.exports,k=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-drawer",{attrs:{title:"详情",visible:e.drawer,size:800},on:{"update:visible":function(t){e.drawer=t}}},[a("div",{staticClass:"infoContainer",staticStyle:{padding:"0 16px"}},[a("pre",{ref:"formatInfo",staticStyle:{"white-space":"pre-wrap"}})])])},L=[],y=(a("a481"),a("e2c1")),R=a("1487"),w=a.n(R),x=(a("8da8"),{components:{},data:function(){return{drawer:!1,info:""}},watch:{info:function(){var e=this;this.$nextTick((function(){var t=e.$refs.formatInfo;t.innerHTML=w.a.highlight("yaml",y["a"].dump(e.info)).value}))}},methods:{openDrawer:function(e){this.info=e,this.drawer=!0},syntaxHighlight:function(e){return"string"!==typeof e&&(e=JSON.stringify(e,void 0,2)),e=e.replace(/&/g,"&").replace(/</g,"<").replace(/>/g,">"),e.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,(function(e){var t="number";return/^"/.test(e)?t=/:$/.test(e)?"key":"string":/true|false/.test(e)?t="boolean":/null/.test(e)&&(t="null"),'<span class="'+t+'">'+e+"</span>"}))}}}),_=x,N=(a("60e2"),Object(g["a"])(_,k,L,!1,null,"7628337c",null)),S=N.exports,j={components:{creattask:v,taskInfo:S},props:{},data:function(){return{isLoading:!1,triggersSetsData:[],pagination:{currentPage:1,pageSize:10,total:100}}},computed:{tableView:function(){return this.pagination.total<=this.pagination.pageSize?this.triggersSetsData:this.triggersSetsData.slice((this.pagination.currentPage-1)*this.pagination.pageSize,this.pagination.pageSize)}},created:function(){this.triggersSetsFn()},methods:{createNewDiagnosis:function(){this.$refs.add.openDialog()},triggersSetsFn:function(){var e=this;this.isLoading=!0,s({}).then((function(t){t.success&&(e.pagination.total=t.data.length,e.pagination.currentPage=1,e.triggersSetsData=t.data),e.isLoading=!1})).catch((function(){e.isLoading=!1}))},handleSizeChange:function(e){this.pagination.pageSize=e,this.operationSetsFn2()},handleCurrentChange:function(e){this.pagination.currentPage=e},formatter:function(e){return Object(l["e"])(e.time||"","{y}-{m}-{d} {h}:{i}:{s}")},editData:function(e){this.$refs.info.openDrawer(e.detail)}}},$=j,O=Object(g["a"])($,r,n,!1,null,"5366ce09",null);t["default"]=O.exports},d510:function(e,t,a){"use strict";a.d(t,"c",(function(){return n})),a.d(t,"b",(function(){return o})),a.d(t,"e",(function(){return s})),a.d(t,"d",(function(){return i})),a.d(t,"f",(function(){return l})),a.d(t,"a",(function(){return c}));a("7f7f");var r=a("b775");function n(e){return Object(r["a"])({url:"/v1/diagnoses",method:"get",params:e})}function o(e){return Object(r["a"])({url:"/v1/diagnoses/".concat(e.name),method:"post",data:e})}function s(){return Object(r["a"])({url:"/v1/nodes",method:"get"})}function i(){return Object(r["a"])({url:"/v1/namespaces",method:"get"})}function l(e){return Object(r["a"])({url:"/v1/namespaces/".concat(e,"/pods"),method:"get"})}function c(e){return Object(r["a"])({url:"/v1/checkName/".concat(e.name),method:"get"})}},ebb4:function(e,t,a){}}]);